<!DOCTYPE html>
<head>
    <meta charset="utf-8">
    <title>clicker games</title>
    <style>
        body {
            font-family: "Arial", sans-serif;
            background-color: #e8f5e9; /* 淡绿色背景色 */
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
            margin: 0;
            color: #333;
            -webkit-user-select: none;  /* Safari 3.1+ */
            -moz-user-select: none;     /* Firefox 2+ */
            -ms-user-select: none;      /* IE 10+ */
            user-select: none;          /* 标准的语法 */
        }

        #score {
            width: 500px;
            text-align: center;
            border: 10px solid rgb(0, 147, 184);
            padding: 20px;
            margin-bottom: 20px;
            background-color: #ffffff; /* 白色背景 */
            box-shadow: 3px 3px 15px rgba(0,0,0,0.2); /* 轻微的阴影 */
            font-weight: bold;
            font-size: xx-large;
        }
        #score span {
            display: block;
        }

        button {
            padding: 10px 20px;
            margin: 10px;
            font-size: medium;
            cursor: pointer;
            border: none;
            border-radius: 5px; /* 圆角 */
            background-color: #009688; /* 深绿色背景色 */
            color: white; /* 白色文字 */
            transition: background-color 0.3s; /* 平滑的过渡效果 */
        }

        button:hover {
            background-color: #00796b; /* 当鼠标悬停时，变为更深的绿色 */
        }

        button:disabled {
            background-color: #B0BEC5; /* 当按钮不可用时，变为灰色 */
            cursor: not-allowed;
        }
        @keyframes floatFade {
            0% { opacity: 1; transform: translateY(0); }
            100% { opacity: 0; transform: translateY(-30px); }
        }

        .floatFade {
            position: absolute;
            animation: floatFade 1.5s forwards;
            font-size: 20px;
            font-weight: bold;
            color: #009688;
        }
        .criticalHit {
            color: red;
        }

        .upgradeNotification {
            position: absolute;  /* 改为absolute */
            background-color: #009688;
            color: white;
            padding: 10px;
            border-radius: 5px;
            animation: floatFade 3s forwards;
            transform: translateX(-50%);  /* 水平居中 */
        }


    </style>
</head>
<body>
    <p id="score">
        <span id="scoreText">SCORE: </span>
        <span id="scoreNumber"></span>
    </p>
    <button type="button" id="get" onclick="add_score(1)">Get Money</button>

    <button type="button" id="upgrade_scoreup" onclick="upgrade1()" disabled="false"></button>
    <button type="button" id="upgrade_attrs" onclick="upgrade3()" disabled="false"></button>
    <button type="button" id="upgrade_auto" onclick="upgrade2()" disabled="false"></button>
    
    <script>
        var SCORE = 30;
        var upgrade_scoreup_need = 50;
        var upgrade_auto_need = 200;
        var threads = [];
        var upgrade_scoreup_num = 0;
        var upgrade_attrs_need = 50;
        var Crit = 0.5;
        var CritMultipler = 125;
        
        if (!String.prototype.format) {
            String.prototype.format = function() {
                var args = arguments;
                return this.replace(/{(\d+)}/g, function(match, number) { 
                return typeof args[number] != 'undefined'
                    ? args[number]
                    : match
                ;
                });
            };
        }

        var GETTER_TEXT = null;
        var SCORE_TEXT = null;
        var SCOREUP_TEXT = null;
        var AUTO = null;
        var ATTRS = null;
        var UPGRADE1_TEXT = null;
        var UPGRADE2_TEXT = null;
        var UPGRADE2NEW_TEXT = null;
        var UPGRADE3_TEXT = null;

        var none = null;
        var template = {
            "GETTER": none,
            "SCORE": none,
            "SCOREUP": none,
            "AUTO": none,
            "ATTRS": none,
            "UPGRADE1": none,
            "UPGRADE2": none,
            "UPGRADE2NEW": none,
            "UPGRADE3": none
        }
        function setup() {
            t = arguments[0];
            var index = 1;
            for(var key in t) {
                t[key] = arguments[index++];
            }
            return t;
        }

        var english = setup(
            template,
            "Make Money: +{0}$",
            "Money:",
            "Upgrades make money: {0}$",
            "Purchase/Upgrade Money Getter: {0}$",
            "Upgrade money critical chance: {0}$",
            "Money production upgrade successful! Additional money gained: +{0}$",
            "Upgrade Money Getter Successful! Get +{0}$ extra money and increase speed by +{1}ms",
            "Purchase Money Getter Successful! Get +{0}$ extra money.",
            "Upgrading critical hit rate successfully! critical chance +{0}%, critical multiplier +{1}%",
        )
        var chinese = setup(
            template,
            "获取金钱: +{0}$",
            "金钱: ",
            "升级获取金钱数量: {0}$",
            "购买/升级 金钱获取器: {0}$",
            "增加暴击率: {0}$",
            "升级金钱获取数量成功，每次额外获得 +{0}$",
            "升级金钱获取器成功！你的获取金钱器获取速度+{1}ms, 获取数量+{0}$",
            "购买新的金钱获取器成功！你的获取器每次获得+{0}$",
            "升级暴击率成功！ 暴击率+{0}% 暴击倍率+{1}%"
        )

        function changeLanguage(targetObject) {
            GETTER_TEXT = targetObject["GETTER"];
            SCORE_TEXT = targetObject["SCORE"];
            SCOREUP_TEXT = targetObject["SCOREUP"];
            AUTO = targetObject["AUTO"];
            ATTRS = targetObject["ATTRS"];
            UPGRADE1_TEXT = targetObject["UPGRADE1"];
            UPGRADE2_TEXT = targetObject["UPGRADE2"];
            UPGRADE2NEW_TEXT = targetObject["UPGRADE2NEW"];
            UPGRADE3_TEXT = targetObject["UPGRADE3"];
        }


        let getter = document.getElementById("get");
        var score_label = document.getElementById("score");
        let scoreTextSpan = document.getElementById("scoreText");
        let scoreNumberSpan = document.getElementById("scoreNumber");
        var upgrade_scoreup_button = document.getElementById("upgrade_scoreup");
        var upgrade_auto_button = document.getElementById("upgrade_auto");
        var upgrade_attrs_button = document.getElementById("upgrade_attrs");
        
        function getRandomInt(min, max) {
            min = Math.ceil(min);
            max = Math.floor(max);
            return Math.floor(Math.random() * (max - min + 1)) + min;
        }

        function auto_getscore(num) {
            let isCritical = Math.random() <= (Crit - 0.15) / 100;
            if(isCritical) {
                num = Math.floor(num * ((CritMultipler * 2) / 100));
            }
            SCORE += num;
            createHit(num, isCritical, -235, 45);
            update();
        }

        function upgrade1() {
            SCORE -= upgrade_scoreup_need;
            upgrade_scoreup_need = Math.floor(upgrade_scoreup_need * 2.5);
            addnum = Math.floor((upgrade_scoreup_num + 1) * 1.5);
            upgrade_scoreup_num += addnum;
            showUpgradeNotification(UPGRADE1_TEXT.format(addnum));
            update();
        }
        function upgrade2() {
            SCORE -= upgrade_auto_need;
            origin_timeout = null;
            if(threads.length <= 0) {
                timeout = 5000;
                threads.push([setInterval(auto_getscore, timeout, 1), timeout, 1]);
            } else {
                var newthread = false;
                
                thread_id = threads.length - 1;
                clearInterval(threads[thread_id][0]);
                threads[thread_id][2] = Math.floor((threads[thread_id][2] + 1) * 1.55);
                origin_timeout = threads[thread_id][1];
                threads[thread_id][1] -= 200;
                threads[thread_id][0] = setInterval(auto_getscore, threads[thread_id][1], threads[thread_id][2]);
                if(threads[thread_id][1] <= 500)
                    newthread = true;
                console.log(`Thread Info(${thread_id}): id: ${threads[thread_id][0]}, timeout: ${threads[thread_id][1]}, value: ${threads[thread_id][2]}`);
        
                if(newthread) {
                    timeout = 6000;
                    value = Math.floor(threads[threads.length - 1][2] / 2);
                    threads.push([setInterval(auto_getscore, timeout, value), timeout, value]);
                }
            }
            upgrade_auto_need = Math.floor(upgrade_auto_need * 1.5);
            if(origin_timeout !== null) {
                showUpgradeNotification(
                    UPGRADE2_TEXT.format(
                            threads[threads.length - 1][2], 
                            origin_timeout - threads[threads.length - 1][1]
                        )
                    );
            } else {
                showUpgradeNotification(
                    UPGRADE2NEW_TEXT.format( 
                            threads[threads.length - 1][2], 
                            origin_timeout - threads[threads.length - 1][1]
                        )
                    );
            }
            
            update();
        }
        function upgrade3() {
            SCORE -= upgrade_attrs_need;
            upgrade_attrs_need = Math.floor(upgrade_attrs_need * 1.5);
            var origin_Crit = Crit;
            var origin_CritMultipler = CritMultipler;
            if(Crit >= 30) {
                Crit += getRandomInt(1, 500) / 100;
                CritMultipler += (Crit - 30) * 100;
                Crit = 30;
            } else if(Crit >= 25) {
                Crit += 0.25;
                CritMultipler += 20;
            } else if(Crit >= 20) {
                Crit += 0.35;
                CritMultipler += 15;
            } else if(Crit >= 10) {
                Crit += 0.55;
                CritMultipler += 10;
            } else {
                Crit += 0.33;
                CritMultipler += 33;
            }
            showUpgradeNotification(
                UPGRADE3_TEXT.format(
                        (Crit - origin_Crit).toFixed(2),
                        (CritMultipler - origin_CritMultipler).toFixed(2)
                    )
                );
            update();
        }

        function showUpgradeNotification(message) {
            let notification = document.createElement("div");
            notification.textContent = message;
            notification.classList.add("upgradeNotification");
            
            // 获取"SCORE: 514"的位置
            let scoreLabel = document.querySelector("#score");  // 假设"SCORE: 514"的id为"score_label_id"
            let rect = scoreLabel.getBoundingClientRect();
            
            // 设置提示框的位置
            notification.style.left = window.innerWidth / 2 - message.length / 2;
            notification.style.top = (rect.top - notification.offsetHeight - 100) + "px"; // 提示框的高度上方，并额外上移10px

            document.body.appendChild(notification);

            setTimeout(function() {
                document.body.removeChild(notification);
            }, 3000);  // 3秒后自动移除提示
        }

        function init() {
            changeLanguage(chinese);
            update();
        }        

        function update() {
            getter.textContent = GETTER_TEXT.format(1 + upgrade_scoreup_num);
            scoreTextSpan.textContent = SCORE_TEXT;
            scoreNumberSpan.textContent = SCORE + "$";
            upgrade_scoreup_button.textContent = SCOREUP_TEXT.format(upgrade_scoreup_need);
            upgrade_auto_button.textContent = AUTO.format(upgrade_auto_need);
            upgrade_attrs_button.textContent = ATTRS.format(upgrade_attrs_need);

            upgrade_scoreup_button.disabled = !(SCORE >= upgrade_scoreup_need);
            upgrade_auto_button.disabled = !(SCORE >= upgrade_auto_need);
            upgrade_attrs_button.disabled = !(SCORE >= upgrade_attrs_need);
        }

        function createHit(num, isCritical=false, offsetX=-235, offsetY=80) {
            // 创建一个新的元素来显示获得的分数
            let floatingText = document.createElement("div");
            floatingText.textContent = "+" + num + "$";
            floatingText.classList.add("floatFade");
            
            if(isCritical) {
                floatingText.classList.add("criticalHit");
            }

            // 计算初始位置
            let scoreRect = score_label.getBoundingClientRect();
            floatingText.style.left = (scoreRect.right + offsetX) + "px";  // 将其置于score_label的右侧，并稍微向左偏移
            floatingText.style.top = scoreRect.top + offsetY + "px";

            // 将元素添加到页面上
            document.body.appendChild(floatingText);

            // 在动画完成后，从页面上删除此元素
            floatingText.addEventListener("animationend", function() {
                document.body.removeChild(floatingText);
            });
        }

        function add_score(num) {
            num += upgrade_scoreup_num;
            let isCritical = Math.random() <= Crit / 100;
            if(isCritical) {
                num = Math.floor(num * (CritMultipler / 100));
            }
            SCORE += num;
            createHit(num, isCritical);
            update();
        }
        
        init();
        
    </script>
</body>